version: "3.9"

# Docker Compose for Unified Benchmark Environment
# Starts Neo4j and FalkorDB containers for benchmark comparison
#
# Usage:
#   docker compose -f benchmarks/docker-compose.benchmark.yml up -d
#   python benchmarks/unified_benchmark.py
#   docker compose -f benchmarks/docker-compose.benchmark.yml down

services:
  # Neo4j - Enterprise Graph Database
  neo4j:
    image: neo4j:5.15-community
    container_name: benchmark-neo4j
    ports:
      - "17474:7474"  # HTTP
      - "17687:7687"  # Bolt
    environment:
      - NEO4J_AUTH=neo4j/benchmark123
      - NEO4J_PLUGINS=["apoc"]
      - NEO4J_apoc_export_file_enabled=true
      - NEO4J_apoc_import_file_enabled=true
      - NEO4J_dbms_memory_heap_initial__size=512m
      - NEO4J_dbms_memory_heap_max__size=2G
      - NEO4J_dbms_memory_pagecache_size=512m
    volumes:
      - neo4j_benchmark_data:/data
      - neo4j_benchmark_logs:/logs
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:7474 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - benchmark_net

  # FalkorDB - Redis-based Graph Database
  falkordb:
    image: falkordb/falkordb:latest
    container_name: benchmark-falkordb
    ports:
      - "16379:6379"  # Redis protocol
    environment:
      - FALKORDB_ARGS=--maxmemory 2gb --maxmemory-policy allkeys-lru
    volumes:
      - falkordb_benchmark_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - benchmark_net

  # Optional: Redis Insight for FalkorDB visualization
  redisinsight:
    image: redislabs/redisinsight:latest
    container_name: benchmark-redisinsight
    ports:
      - "18001:8001"
    depends_on:
      - falkordb
    networks:
      - benchmark_net
    profiles:
      - tools

volumes:
  neo4j_benchmark_data:
  neo4j_benchmark_logs:
  falkordb_benchmark_data:

networks:
  benchmark_net:
    driver: bridge

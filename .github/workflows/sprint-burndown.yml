name: Sprint Burndown Report

on:
  schedule:
    - cron: '0 18 * * *'  # Run every day at 6 PM UTC
  workflow_dispatch:  # Allow manual trigger

jobs:
  sprint-burndown:
    runs-on: ubuntu-latest
    name: Generate Sprint Burndown
    steps:
      - name: Calculate burndown
        uses: actions/github-script@v7
        with:
          script: |
            const milestones = await github.rest.issues.listMilestones({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open'
            });
            
            for (const milestone of milestones.data) {
              const issues = await github.rest.issues.listForRepo({
                owner: context.repo.owner,
                repo: context.repo.repo,
                milestone: milestone.number,
                state: 'all'
              });
              
              const total = issues.data.length;
              const closed = issues.data.filter(i => i.state === 'closed').length;
              const open = total - closed;
              
              console.log(`Milestone: ${milestone.title}`);
              console.log(`Total: ${total}, Closed: ${closed}, Open: ${open}`);
              console.log(`Progress: ${Math.round(closed/total * 100)}%`);
            }
